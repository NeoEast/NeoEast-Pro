<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>NeoEast 5.0 ‚Ä¢ Gest√£o de IMEI</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#f6f8fa; --primary:#513863; --primary-light:#8856ad;
  --secondary:#8898aa; --success:#2dce89; --danger:#f5365c;
  --text-dark:#32325d; --shadow:0 10px 30px rgba(50,50,93,0.1),0 6px 10px rgba(0,0,0,0.08);
  --transition:0.35s ease-in-out; --ripple-color:rgba(255,255,255,0.3);
}
*{box-sizing:border-box;scroll-behavior:smooth;}
body{margin:0;padding:0;font-family:"Roboto",sans-serif;background:var(--bg);color:var(--text-dark);overflow-x:hidden;}
#loginContainer{width:92%;max-width:400px;margin:50px auto;padding:30px;background:#fff;border-radius:18px;box-shadow:var(--shadow);text-align:center;}
#loginContainer input{width:100%;padding:12px;margin:10px 0;border-radius:12px;border:1px solid var(--secondary);font-size:15px;}
#loginContainer button{background:var(--primary);color:#fff;border:none;padding:12px;border-radius:12px;font-size:16px;cursor:pointer;width:100%;margin-top:10px;}
#mainContent{display:none;width:92%;max-width:980px;margin:0 auto;padding-top:30px;}
header{text-align:center;margin-bottom:40px;}
header h1{font-size:2.6rem;color:var(--primary);font-weight:700;letter-spacing:1px;}
.tabs{display:flex;justify-content:center;gap:12px;margin-bottom:30px;flex-wrap:wrap;}
.tabs button{background: var(--white);border:2px solid var(--primary-light);padding:12px 24px;border-radius:30px;font-weight:600;color:var(--primary);cursor:pointer;box-shadow:var(--shadow);position:relative;overflow:hidden;transition:var(--transition);}
.tabs button.active{background: var(--primary);color:#fff;border-color:var(--primary);}
section{display:none;background:var(--white);padding:28px;border-radius:18px;box-shadow:var(--shadow);border:1px solid var(--secondary);margin-bottom:50px;opacity:0;transform:translateX(50px);transition:all 0.5s ease;}
section.active{display:block;opacity:1;transform:translateX(0);}
h2{margin-bottom:22px;font-size:1.7rem;color:var(--primary);font-weight:700;}
input{width:100%;padding:14px;margin:10px 0;border-radius:12px;border:1px solid var(--secondary);font-size:15px;transition:all 0.3s;}
input:focus{border-color: var(--primary);box-shadow:0 0 0 5px rgba(94,114,228,0.2);outline:none;}
button{width:100%;padding:15px;margin:14px 0;border-radius:14px;border:none;background:var(--primary);color:#fff;font-weight:600;cursor:pointer;font-size:16px;box-shadow:var(--shadow);position:relative;overflow:hidden;transition:all 0.3s;}
button:hover{transform:translateY(-3px);box-shadow:0px 15px 25px rgba(50,50,93,0.15),0px 6px 12px rgba(0,0,0,0.08);}
button.venda{background: var(--success);}
#chatBox{max-height:300px;overflow-y:auto;background:#fff;padding:15px;border-radius:12px;border:1px solid var(--secondary);margin-top:10px;box-shadow:var(--shadow);}
.msg-vendedor span{background:#513863;color:#fff;}
.msg-supervisor span{background:#2dce89;color:#fff;}
.msg-administrador span{background:#000;color:#fff;}
.msg-vendedor,.msg-supervisor,.msg-administrador{margin-bottom:8px;text-align:left;}
</style>
</head>

<body>
<div id="loginContainer">
  <h2>Login</h2>
  <input id="loginUser" placeholder="Usu√°rio">
  <input id="loginPass" type="password" placeholder="Senha">
  <button onclick="fazerLogin()">Entrar</button>
</div>

<div id="mainContent">
<header><h1>Gest√£o de IMEI</h1></header>
<div class="tabs">
<button class="active" onclick="openTab('cadastro',this)">Cadastrar</button>
<button onclick="openTab('consulta',this)">Consultar</button>
<button onclick="openTab('dashboard',this)">Dashboard</button>
<button onclick="openTab('chat',this)">Chat</button>
</div>

<!-- CADASTRO -->
<section id="cadastro" class="active">
<h2>üì¶ Cadastrar IMEI</h2>
<input id="imei" placeholder="IMEI (15 d√≠gitos)">
<input id="marca" placeholder="Marca">
<input id="modelo" placeholder="Modelo">
<input id="memoria" placeholder="Mem√≥ria">
<input id="ano" placeholder="Ano">
<input id="preco" placeholder="Pre√ßo do dispositivo (R$)">
<button onclick="cadastrarIMEI()">Cadastrar</button>
</section>

<!-- CONSULTA -->
<section id="consulta">
<h2>üîç Consultar IMEI</h2>
<input id="consultaImei" placeholder="Digite o IMEI">
<button onclick="consultarIMEI()">Consultar</button>
<div id="resultado"></div>
<button onclick="limparConsulta()">Nova Consulta</button>
</section>

<!-- DASHBOARD -->
<section id="dashboard">
<h2>üìä Dashboard</h2>
<div class="dashboard">
  <div class="stat" onclick="filtrarEstoque()"><h3 id="estoque">0</h3><p>Em Estoque</p></div>
  <div class="stat" onclick="filtrarVendidos()"><h3 id="vendidos">0</h3><p>Vendidos</p></div>
  <div class="stat"><h3 id="saldoDiario">R$ 0,00</h3><p>Saldo Di√°rio</p></div>
</div>
<h3 style="margin-top:30px; color:var(--primary)">üìà Crescimento de Vendas</h3>
<canvas id="graficoVendas" style="width:100%;max-width:800px;height:300px;margin-bottom:30px;"></canvas>
<h3 style="margin-top:30px; color:var(--primary)">üìä Cadastros por Dispositivo</h3>
<canvas id="graficoDispositivos" style="width:100%;max-width:800px;height:300px;"></canvas>
</section>

<!-- CHAT -->
<section id="chat">
<h2>üí¨ Chat do Sistema</h2>
<input id="chatInput" placeholder="Digite sua mensagem">
<button onclick="enviarMensagem()">Enviar</button>
<button id="btnApagarChat" onclick="apagarChat()" style="display:none;background:#f5365c;">Apagar Chat (Admin)</button>
<div id="chatBox"></div>
</section>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyArvdpIltCvs3Y-2sCfhrBbYR8i86rbMh8",
  authDomain:"gestao-imei-loja.firebaseapp.com",
  projectId:"gestao-imei-loja"
});
const db=firebase.firestore();

/* LOGIN */
const usuarios = {
  // Administrador
  "Alisson": { senha: "Alisson16@", nome: "Alisson Carvalho", cargo: "administrador" },

  // Supervisores
  "Rodrigo": { senha: "456456", nome: "Rodrigo Santos", cargo: "supervisor" },
  "Ailton": { senha: "456223", nome: "Ailton Sena", cargo: "supervisor" },
  "fabio": { senha: "sup3", nome: "F√°bio Almeida", cargo: "supervisor" },
  "carla": { senha: "sup4", nome: "Carla Souza", cargo: "supervisor" },

  // Vendedores
  "Milena": { senha: "121999", nome: "Milena Sena", cargo: "vendedor" },
  "Natally": { senha: "Natally15", nome: "Natally Silva", cargo: "vendedor" },
  "Emille": { senha: "201312", nome: "Emille Beatriz", cargo: "vendedor" },
  "camila": { senha: "camila01", nome: "Camila Rocha", cargo: "vendedor" },
  "daniel": { senha: "daniel01", nome: "Daniel Martins", cargo: "vendedor" },
  "eduarda": { senha: "eduarda01", nome: "Eduarda Fernandes", cargo: "vendedor" },
  "fabiana": { senha: "fabiana01", nome: "Fabiana Teixeira", cargo: "vendedor" },
  "gustavo": { senha: "gustavo01", nome: "Gustavo Barros", cargo: "vendedor" },
  "henrique": { senha: "henrique01", nome: "Henrique Dias", cargo: "vendedor" },
  "isabela": { senha: "isabela01", nome: "Isabela Nunes", cargo: "vendedor" },
  "joao": { senha: "joao01", nome: "Jo√£o Pereira", cargo: "vendedor" },
  "karina": { senha: "karina01", nome: "Karina Melo", cargo: "vendedor" },
  "leandro": { senha: "leandro01", nome: "Leandro Costa", cargo: "vendedor" },
  "marcio": { senha: "marcio01", nome: "M√°rcio Lima", cargo: "vendedor" },
  "natasha": { senha: "natasha01", nome: "Natasha Alves", cargo: "vendedor" },
  "paulo": { senha: "paulo01", nome: "Paulo Rocha", cargo: "vendedor" }
};
let usuarioAtual=null;

function fazerLogin(){
  const u=document.getElementById("loginUser").value.trim();
  const s=document.getElementById("loginPass").value.trim();
  if(!usuarios[u]||usuarios[u].senha!==s){ alert("Usu√°rio ou senha incorretos!"); return; }
  usuarioAtual=usuarios[u];
  document.getElementById("loginContainer").style.display="none";
  document.getElementById("mainContent").style.display="block";
  if(usuarioAtual.cargo==="administrador"){document.getElementById("btnApagarChat").style.display="block";}
}

/* TABS */
function openTab(id,btn){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  btn.classList.add("active");
}

/* CADASTRO */
function cadastrarIMEI(){
  const imei = document.getElementById("imei").value.trim();
  const marca = document.getElementById("marca").value.trim();
  const modelo = document.getElementById("modelo").value.trim();
  const memoria = document.getElementById("memoria").value.trim();
  const ano = document.getElementById("ano").value.trim();
  const preco = parseFloat(document.getElementById("preco").value.trim());

  if(!/^\d{15}$/.test(imei)){ alert("IMEI inv√°lido!"); return; }
  if(isNaN(preco) || preco <= 0){ alert("Pre√ßo inv√°lido!"); return; }

  db.collection("imei_database").doc(imei).set({
    imei, marca, modelo, memoria, ano, preco,
    status:"EM ESTOQUE",
    dataEntrada: firebase.firestore.FieldValue.serverTimestamp(),
    dataVenda: null
  }).then(()=>{
    alert("IMEI Cadastrado!");
    document.querySelectorAll("#cadastro input").forEach(i=>i.value="");
  });
}

/* CONSULTA */
function consultarIMEI(){
  const imei=document.getElementById("consultaImei").value.trim();
  const r=document.getElementById("resultado");
  db.collection("imei_database").doc(imei).get().then(doc=>{
    if(!doc.exists){r.innerHTML=`<p style="color:red">IMEI n√£o encontrado</p>`; return;}
    const d=doc.data();
    r.innerHTML=`<div class="card">
  <p><b>IMEI:</b> ${d.imei}</p>
  <p><b>Marca:</b> ${d.marca}</p>
  <p><b>Modelo:</b> ${d.modelo}</p>
  <p><b>Pre√ßo:</b> R$ ${d.preco.toFixed(2)}</p>
  <p><b>Status:</b> <span class="${d.status==='VENDIDO'?'status-vendido':'status-estoque'}">${d.status}</span></p>
  ${d.status==='EM ESTOQUE'?`<button class="venda" onclick="confirmarVenda('${d.imei}')">Confirmar Venda</button>`:''}
</div>`;
  });
}
function limparConsulta(){document.getElementById("consultaImei").value="";document.getElementById("resultado").innerHTML="";}

/* CONFIRMAR VENDA */
function confirmarVenda(imei){
  db.collection("imei_database").doc(imei).update({status:"VENDIDO",dataVenda:firebase.firestore.FieldValue.serverTimestamp()})
  .then(()=>{alert("Venda Confirmada!");consultarIMEI();});
}

/* DASHBOARD */
db.collection("imei_database").onSnapshot(()=>{ carregarDashboard(); });
function gerarGraficos(snap){
  let vendasPorDia={}, cadastrosPorDispositivo={};
  snap.forEach(doc=>{
    const data=doc.data();
    const dataVenda=data.dataVenda?.toDate();
    if(dataVenda){const dia=`${dataVenda.getDate()}/${dataVenda.getMonth()+1}`; vendasPorDia[dia]=(vendasPorDia[dia]||0)+1;}
    const device=`${data.marca} ${data.modelo}`;
    cadastrosPorDispositivo[device]=(cadastrosPorDispositivo[device]||0)+1;
  });
  new Chart(document.getElementById("graficoVendas").getContext("2d"),{type:'line',data:{labels:Object.keys(vendasPorDia),datasets:[{label:'Vendas',data:Object.values(vendasPorDia),borderColor:'rgba(94,114,228,1)',backgroundColor:'rgba(94,114,228,0.2)',tension:0.4,fill:true}]},options:{responsive:true,plugins:{legend:{display:true}},scales:{y:{beginAtZero:true,precision:0}}}});
  new Chart(document.getElementById("graficoDispositivos").getContext("2d"),{type:'bar',data:{labels:Object.keys(cadastrosPorDispositivo),datasets:[{label:'Cadastros',data:Object.values(cadastrosPorDispositivo),backgroundColor:'rgba(94,114,228,0.6)',borderColor:'rgba(94,114,228,1)',borderWidth:1}]},options:{responsive:true,plugins:{legend:{display:true}},scales:{y:{beginAtZero:true,precision:0}}}});
}
function carregarDashboard(){db.collection("imei_database").get().then(snap=>{let estoque=0,vendidos=0;snap.forEach(doc=>doc.data().status==="VENDIDO"?vendidos++:estoque++);document.getElementById("estoque").innerText=estoque;document.getElementById("vendidos").innerText=vendidos;gerarGraficos(snap);});}
function carregarDashboard(){
  db.collection("imei_database").get().then(snap=>{
    let estoque=0,vendidos=0;
    snap.forEach(doc=>doc.data().status==="VENDIDO"?vendidos++:estoque++);
    document.getElementById("estoque").innerText=estoque;
    document.getElementById("vendidos").innerText=vendidos;
    gerarGraficos(snap);

    // Atualiza saldo di√°rio
    atualizarSaldoDiario();
  });
}

/* CHAT */
function enviarMensagem(){
  const msgInput=document.getElementById("chatInput");
  const msg=msgInput.value.trim();
  if(!usuarioAtual){alert("Voc√™ precisa estar logado!"); return;}
  if(!msg){return;}
  db.collection("chat_messages").add({usuario:usuarioAtual.nome,cargo:usuarioAtual.cargo,mensagem:msg,data:firebase.firestore.FieldValue.serverTimestamp()});
  msgInput.value="";
}

db.collection("chat_messages").orderBy("data").onSnapshot(snapshot=>{
  const chatBox=document.getElementById("chatBox");
  chatBox.innerHTML="";
  snapshot.forEach(doc=>{
    const msg=doc.data();
    const div=document.createElement("div");
    div.className=`msg-${msg.cargo}`;
    div.innerHTML=`<span><b>${msg.usuario}</b>: ${msg.mensagem}</span>`;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop=chatBox.scrollHeight;
});

/* APAGAR CHAT */
function apagarChat(){
  if(!usuarioAtual||usuarioAtual.cargo!=="administrador"){alert("Apenas administradores podem apagar o chat!"); return;}
  if(!confirm("Tem certeza que deseja apagar todas as mensagens?")) return;
  db.collection("chat_messages").get().then(snapshot=>{
    const batch=db.batch();
    snapshot.forEach(doc=>batch.delete(doc.ref));
    batch.commit();
  });
}
function atualizarSaldoDiario(){
  const hoje = new Date();
  const diaString = `${hoje.getFullYear()}-${hoje.getMonth()+1}-${hoje.getDate()}`;

  // Cria o documento do dia caso n√£o exista
  db.collection("vendas_diarias").doc(diaString).get().then(doc=>{
    if(!doc.exists){
      db.collection("vendas_diarias").doc(diaString).set({ saldo: 0 });
    }
  });

  // Calcula o saldo di√°rio
  db.collection("imei_database").where("status","==","VENDIDO").onSnapshot(snap=>{
    let saldo = 0;
    snap.forEach(doc=>{
      const d = doc.data();
      const dataVenda = d.dataVenda?.toDate();
      if(!dataVenda) return;

      const diaVenda = `${dataVenda.getFullYear()}-${dataVenda.getMonth()+1}-${dataVenda.getDate()}`;
      if(diaVenda === diaString){
        saldo += d.preco || 0;
      }
    });
    db.collection("vendas_diarias").doc(diaString).set({ saldo });
    document.getElementById("saldoDiario").innerText = `R$ ${saldo.toFixed(2)}`;
  });
}
</script>
</body>
</html>